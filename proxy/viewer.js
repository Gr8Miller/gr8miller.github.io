/*! For license information please see viewer.js.LICENSE */
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){n.r(e),n.d(e,"__extends",(function(){return o})),n.d(e,"__assign",(function(){return i})),n.d(e,"__rest",(function(){return a})),n.d(e,"__decorate",(function(){return s})),n.d(e,"__param",(function(){return c})),n.d(e,"__metadata",(function(){return l})),n.d(e,"__awaiter",(function(){return u})),n.d(e,"__generator",(function(){return f})),n.d(e,"__exportStar",(function(){return d})),n.d(e,"__values",(function(){return h})),n.d(e,"__read",(function(){return p})),n.d(e,"__spread",(function(){return g})),n.d(e,"__spreadArrays",(function(){return m})),n.d(e,"__await",(function(){return y})),n.d(e,"__asyncGenerator",(function(){return x})),n.d(e,"__asyncDelegator",(function(){return v})),n.d(e,"__asyncValues",(function(){return b})),n.d(e,"__makeTemplateObject",(function(){return N})),n.d(e,"__importStar",(function(){return w})),n.d(e,"__importDefault",(function(){return M}));var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function s(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function c(t,e){return function(n,r){e(n,r,t)}}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new n((function(e){e(t.value)})).then(a,s)}c((r=r.apply(t,e||[])).next())}))}function f(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function d(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function h(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function m(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function x(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(t,e||[]),i=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){o[t]&&(r[t]=function(e){return new Promise((function(n,r){i.push([t,e,n,r])>1||s(t,e)}))})}function s(t,e){try{(n=o[t](e)).value instanceof y?Promise.resolve(n.value.v).then(c,l):u(i[0][2],n)}catch(t){u(i[0][3],t)}var n}function c(t){s("next",t)}function l(t){s("throw",t)}function u(t,e){t(e),i.shift(),i.length&&s(i[0][0],i[0][1])}}function v(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,o){e[r]=t[r]?function(e){return(n=!n)?{value:y(t[r](e)),done:"return"===r}:o?o(e):e}:o}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=h(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,o){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,o,(e=t[n](e)).done,e.value)}))}}}function N(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function w(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function M(t){return t&&t.__esModule?t:{default:t}}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});const r=n(0).__importDefault(n(6));class o{static async getMarkMetas(t){const e=t.hash.trim(),n=e.indexOf(":anymark:");return n>-1?e.substr(":anymark:".length+n):null}static setMarkMetas(t,e){const n=e.hash.trim().indexOf(":anymark:"),r=e.hash.substring(0,n>-1?n:e.hash.length);return e.hash=r+`:anymark:${t}`,e.toString()}static clearMarkMetas(t){const e=t.hash.trim(),n=e.indexOf(":anymark:");n>-1&&(t.hash=e.substring(0,n))}static readLocally(t=document.location){const e=r.default(t.origin+t.pathname+t.search);return new Promise(t=>{o.isExtension()?chrome.storage.sync.get([e],n=>t(n[e]||"")):t(localStorage.getItem(e)||"")})}static saveLocally(t,e=document.location){const n=r.default(e.origin+e.pathname+e.search);return new Promise(e=>{o.isExtension()?chrome.storage.sync.set({[n]:t},e):e(localStorage.setItem(n,t))})}static isExtension(){return window.chrome&&chrome.storage&&chrome.storage.sync}static toElement(t,e=document){const n=e.createElement("div");return n.innerHTML=t.trim(),n.firstChild}static any(t){return Promise.all(t.map(t=>t.then(t=>Promise.reject(t),t=>Promise.resolve(t)))).then(t=>Promise.reject(t),t=>Promise.resolve(t))}static async resolved(t){return(await Promise.all(t.map(t=>t.then(t=>Promise.resolve(t),t=>Promise.resolve(new Error(t)))))).filter(t=>!(t instanceof Error))}static async fetchQuiet(t,e){try{const n=await fetch(t);return n&&n.ok&&200===n.status?(e&&(n.attach=e),n):await Promise.reject()}catch(t){return await Promise.reject()}}static async fetch(t,e=5e3,n){return Promise.race([o.fetchQuiet(t,n),new Promise((t,n)=>setTimeout(()=>n(new Error("timeout")),e))])}static copy(t,e="text/plain"){const n=t,r=t=>{t.clipboardData.setData(e,n),t.preventDefault()};document.addEventListener("copy",r),document.execCommand("copy",!1,void 0),document.removeEventListener("copy",r)}static async wait(t){return t>0?new Promise(e=>setTimeout(e,t)):void 0}}e.default=o},function(t,e){var n={utf8:{stringToBytes:function(t){return n.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(n.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e},bytesToString:function(t){for(var e=[],n=0;n<t.length;n++)e.push(String.fromCharCode(t[n]));return e.join("")}}};t.exports=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.LINK=0]="LINK",t[t.HIGHLIGHT=1]="HIGHLIGHT",t[t.SHARE=2]="SHARE",t[t.REMOVE=3]="REMOVE",t[t.MARKS_OFF=4]="MARKS_OFF",t[t.MARKS_ON=5]="MARKS_ON",t[t.TOOLBAR_OFF=6]="TOOLBAR_OFF",t[t.TOOLBAR_ON=7]="TOOLBAR_ON",t[t.PAGE_SETTING=8]="PAGE_SETTING"}(e.Action||(e.Action={})),function(t){t[t.NOTIFICATION=0]="NOTIFICATION",t[t.MARKS_CHANGED=1]="MARKS_CHANGED"}(e.Event||(e.Event={})),function(t){t.CUSTOM_PROXY_SERVERS="custom_proxy_servers",t.ENABLE_PROXY_SERVER="enable_proxy_server",t.USER_PROXY_SERVER="user_proxy_server",t.PROXY_SERVER="hist_proxy_server"}(e.Config||(e.Config={})),function(t){t[t.NONE=0]="NONE",t[t.PINK=1]="PINK",t[t.YELLOW=2]="YELLOW",t[t.GREEN=3]="GREEN",t[t.BLUE=4]="BLUE",t[t.PURPLE=5]="PURPLE"}(e.Color||(e.Color={})),function(t){t.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},t.toSimpleString=function(e){return JSON.stringify(t.flat(e))},t.fromSimpleString=function(e){const n=JSON.parse(e),r=n[4],o={start:{text:n[1],nth:n[0]},end:{text:n[3],nth:n[2]}};return{id:t.uuid(),range:o,color:r}},t.flat=function(t){const e=t.range;return[e.start.nth,e.start.text,e.end.nth,e.end.text,t.color||0]},t.deflat=function(e){const n=e[4],r={start:{text:e[1],nth:e[0]},end:{text:e[3],nth:e[2]}};return{id:t.uuid(),range:r,color:n}}}(e.IMark||(e.IMark={}))},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});const r=n(0);n(5);const o=r.__importDefault(n(1)),i=r.__importDefault(n(9)),a=r.__importDefault(n(12)),s=r.__importDefault(n(14));class c{constructor(t){this.marks=[],this.failed=[],this.$content=t,this.$root=o.default.toElement('<div id="texton-anymark-root"></div>'),this.$content.appendChild(this.$root),this.doc=this.$content.ownerDocument,this.marker=new i.default(this.$content,this.$root)}async refresh(){let t=await o.default.getMarkMetas(this.doc.location);o.default.clearMarkMetas(this.doc.location);const e=c.getTargetUrl(this.doc.location);t=t||await o.default.readLocally(e);const n=new s.default(e);if(this.$root.appendChild(n.$host),this.marker.unmark(this.marks),this.marks=a.default.decodeMarks(t)||[],!(this.marks.length<1))return await o.default.saveLocally(t,e),this.reloadMarks(this.marks)}async reloadMarks(t){this.failed=this.marker.loadMarks(t)||[],await this.marker.scrollTo(t[t.length-1].id,500),this.marker.bling(t,3e3),this.failed&&this.failed.length>0&&(console.debug(`${this.failed.length} highlights failed, try later`),await o.default.wait(1e3),this.reloadMarks(this.failed))}static getTargetUrl(t){const e=decodeURIComponent(t.pathname.substr("/mpflpgaobfpjcpef/proxy".length+1));return new URL(e)}}e.Viewer=c,new c(document.body).refresh()},function(t,e,n){},function(t,e,n){var r,o,i,a,s;r=n(7),o=n(2).utf8,i=n(8),a=n(2).bin,(s=function(t,e){t.constructor==String?t=e&&"binary"===e.encoding?a.stringToBytes(t):o.stringToBytes(t):i(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||(t=t.toString());for(var n=r.bytesToWords(t),c=8*t.length,l=1732584193,u=-271733879,f=-1732584194,d=271733878,h=0;h<n.length;h++)n[h]=16711935&(n[h]<<8|n[h]>>>24)|4278255360&(n[h]<<24|n[h]>>>8);n[c>>>5]|=128<<c%32,n[14+(c+64>>>9<<4)]=c;var p=s._ff,g=s._gg,m=s._hh,y=s._ii;for(h=0;h<n.length;h+=16){var x=l,v=u,b=f,N=d;l=p(l,u,f,d,n[h+0],7,-680876936),d=p(d,l,u,f,n[h+1],12,-389564586),f=p(f,d,l,u,n[h+2],17,606105819),u=p(u,f,d,l,n[h+3],22,-1044525330),l=p(l,u,f,d,n[h+4],7,-176418897),d=p(d,l,u,f,n[h+5],12,1200080426),f=p(f,d,l,u,n[h+6],17,-1473231341),u=p(u,f,d,l,n[h+7],22,-45705983),l=p(l,u,f,d,n[h+8],7,1770035416),d=p(d,l,u,f,n[h+9],12,-1958414417),f=p(f,d,l,u,n[h+10],17,-42063),u=p(u,f,d,l,n[h+11],22,-1990404162),l=p(l,u,f,d,n[h+12],7,1804603682),d=p(d,l,u,f,n[h+13],12,-40341101),f=p(f,d,l,u,n[h+14],17,-1502002290),l=g(l,u=p(u,f,d,l,n[h+15],22,1236535329),f,d,n[h+1],5,-165796510),d=g(d,l,u,f,n[h+6],9,-1069501632),f=g(f,d,l,u,n[h+11],14,643717713),u=g(u,f,d,l,n[h+0],20,-373897302),l=g(l,u,f,d,n[h+5],5,-701558691),d=g(d,l,u,f,n[h+10],9,38016083),f=g(f,d,l,u,n[h+15],14,-660478335),u=g(u,f,d,l,n[h+4],20,-405537848),l=g(l,u,f,d,n[h+9],5,568446438),d=g(d,l,u,f,n[h+14],9,-1019803690),f=g(f,d,l,u,n[h+3],14,-187363961),u=g(u,f,d,l,n[h+8],20,1163531501),l=g(l,u,f,d,n[h+13],5,-1444681467),d=g(d,l,u,f,n[h+2],9,-51403784),f=g(f,d,l,u,n[h+7],14,1735328473),l=m(l,u=g(u,f,d,l,n[h+12],20,-1926607734),f,d,n[h+5],4,-378558),d=m(d,l,u,f,n[h+8],11,-2022574463),f=m(f,d,l,u,n[h+11],16,1839030562),u=m(u,f,d,l,n[h+14],23,-35309556),l=m(l,u,f,d,n[h+1],4,-1530992060),d=m(d,l,u,f,n[h+4],11,1272893353),f=m(f,d,l,u,n[h+7],16,-155497632),u=m(u,f,d,l,n[h+10],23,-1094730640),l=m(l,u,f,d,n[h+13],4,681279174),d=m(d,l,u,f,n[h+0],11,-358537222),f=m(f,d,l,u,n[h+3],16,-722521979),u=m(u,f,d,l,n[h+6],23,76029189),l=m(l,u,f,d,n[h+9],4,-640364487),d=m(d,l,u,f,n[h+12],11,-421815835),f=m(f,d,l,u,n[h+15],16,530742520),l=y(l,u=m(u,f,d,l,n[h+2],23,-995338651),f,d,n[h+0],6,-198630844),d=y(d,l,u,f,n[h+7],10,1126891415),f=y(f,d,l,u,n[h+14],15,-1416354905),u=y(u,f,d,l,n[h+5],21,-57434055),l=y(l,u,f,d,n[h+12],6,1700485571),d=y(d,l,u,f,n[h+3],10,-1894986606),f=y(f,d,l,u,n[h+10],15,-1051523),u=y(u,f,d,l,n[h+1],21,-2054922799),l=y(l,u,f,d,n[h+8],6,1873313359),d=y(d,l,u,f,n[h+15],10,-30611744),f=y(f,d,l,u,n[h+6],15,-1560198380),u=y(u,f,d,l,n[h+13],21,1309151649),l=y(l,u,f,d,n[h+4],6,-145523070),d=y(d,l,u,f,n[h+11],10,-1120210379),f=y(f,d,l,u,n[h+2],15,718787259),u=y(u,f,d,l,n[h+9],21,-343485551),l=l+x>>>0,u=u+v>>>0,f=f+b>>>0,d=d+N>>>0}return r.endian([l,u,f,d])})._ff=function(t,e,n,r,o,i,a){var s=t+(e&n|~e&r)+(o>>>0)+a;return(s<<i|s>>>32-i)+e},s._gg=function(t,e,n,r,o,i,a){var s=t+(e&r|n&~r)+(o>>>0)+a;return(s<<i|s>>>32-i)+e},s._hh=function(t,e,n,r,o,i,a){var s=t+(e^n^r)+(o>>>0)+a;return(s<<i|s>>>32-i)+e},s._ii=function(t,e,n,r,o,i,a){var s=t+(n^(e|~r))+(o>>>0)+a;return(s<<i|s>>>32-i)+e},s._blocksize=16,s._digestsize=16,t.exports=function(t,e){if(null==t)throw new Error("Illegal argument "+t);var n=r.wordsToBytes(s(t,e));return e&&e.asBytes?n:e&&e.asString?a.bytesToString(n):r.bytesToHex(n)}},function(t,e){var n,r;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&r.rotl(t,8)|4278255360&r.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=r.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],n=0,r=0;n<t.length;n++,r+=8)e[r>>>5]|=t[n]<<24-r%32;return e},wordsToBytes:function(t){for(var e=[],n=0;n<32*t.length;n+=8)e.push(t[n>>>5]>>>24-n%32&255);return e},bytesToHex:function(t){for(var e=[],n=0;n<t.length;n++)e.push((t[n]>>>4).toString(16)),e.push((15&t[n]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(parseInt(t.substr(n,2),16));return e},bytesToBase64:function(t){for(var e=[],r=0;r<t.length;r+=3)for(var o=t[r]<<16|t[r+1]<<8|t[r+2],i=0;i<4;i++)8*r+6*i<=8*t.length?e.push(n.charAt(o>>>6*(3-i)&63)):e.push("=");return e.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var e=[],r=0,o=0;r<t.length;o=++r%4)0!=o&&e.push((n.indexOf(t.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<2*o|n.indexOf(t.charAt(r))>>>6-2*o);return e}},t.exports=r},function(t,e){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(n(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(3),i=n(10),a=r.__importDefault(n(11)),s=r.__importDefault(n(1));e.default=class{constructor(t,e){this.listener={onMarkFocused:t=>({}),onMarkBlurred:t=>({})},this.mover=new a.default,this.$content=t,this.$root=e,this.doc=this.$content.ownerDocument,this.xDoc=i.XDocument.from(this.$content)}loadMarks(t){const e=[];if(t&&t.length>0)for(const n of t)try{this.highlight(n)}catch(t){e.push(n)}return e}unmark(t){!t||t instanceof Array||(t=[t]);for(const e of t){const t=`em.texton-anymark.texton-anymark-${e.id}`,n=Array.from(this.doc.querySelectorAll(t)),r=this.doc.querySelector(`#texton-anymark-scrollmark-${e.id}`);r.parentElement.removeChild(r);for(const t of n){const e=t.parentNode;t.replaceWith(t.firstChild),e.normalize()}}}mark(t){const e=i.XSelection.fromTextRange(t.range,!1,this.xDoc);if(!e)throw t;const n=e.getTextNodes();for(const e of n){const n=this.doc.createElement("em");n.classList.add("texton-anymark",`texton-anymark-${t.id}`),e.replaceWith(n),n.appendChild(e),n.addEventListener("click",e=>{this.focus(t)})}this.setScrollMarker(t)}setScrollMarker(t){const e=t.id,n=this.doc.querySelector(`.texton-anymark-${e}`),r=this.getScrollMarkPosition(n),o=`<em id="texton-anymark-scrollmark-${e}" class="texton-anymark-scrollmark" style="top: ${r.top+"px"}; right: ${r.right+"px"}">►</em>`;this.$root.insertAdjacentHTML("beforeend",o),document.querySelector(`#texton-anymark-scrollmark-${e}`).addEventListener("click",async n=>{n.stopImmediatePropagation(),n.preventDefault(),await this.scrollTo(e),this.focus(t)})}highlight(t){this.mark(t);const e=t.color||o.Color.YELLOW,n=`em.texton-anymark.texton-anymark-${t.id}`,r=Array.from(this.doc.querySelectorAll(n));for(const t of r)t.classList.add("highlighted",`texton-bg-${o.Color[e].toLowerCase()||""}`),t.dataset.color=o.Color[e].toLowerCase()||"";this.doc.querySelector(`#texton-anymark-scrollmark-${t.id}`).classList.add("highlighted",`texton-fg-${o.Color[e].toLowerCase()||""}`)}updateColor(t){const e=this.doc.querySelector(`.texton-anymark-${t.id}`).dataset.color,n=o.Color[t.color].toLowerCase();this.doc.querySelectorAll(`.texton-anymark-${t.id}`).forEach(t=>{t.classList.replace(`texton-bg-${e}`,`texton-bg-${n}`),t.dataset.color=n}),this.doc.querySelector(`#texton-anymark-scrollmark-${t.id}`).classList.replace(`texton-fg-${e}`,`texton-fg-${n}`)}bling(t,e=3e3){t.forEach(t=>{const e=`em.texton-anymark.texton-anymark-${t.id}`;this.doc.querySelectorAll(e).forEach(t=>t.classList.add("bling"))}),e>0&&setTimeout(()=>{t.forEach(t=>{const e=`em.texton-anymark.texton-anymark-${t.id}`;this.doc.querySelectorAll(e).forEach(t=>t.classList.remove("bling"))})},e)}focus(t){const e=`em.texton-anymark.texton-anymark-${t.id}`,n=this.doc.querySelectorAll(e);n[0].setAttribute("tabindex","-1");const r=()=>{n[0].removeEventListener("blur",r),n[0].removeAttribute("tabindex"),n.forEach(t=>t.classList.remove("focused")),this.listener.onMarkBlurred(t)};n[0].addEventListener("blur",r),n[0].focus(),n.forEach(t=>t.classList.add("focused")),this.listener.onMarkFocused(t)}async scrollTo(t,e=-1){const n=`em.texton-anymark.texton-anymark-${t}`,r=this.doc.querySelectorAll(n);if(r&&r.length>0)return e>0&&await s.default.wait(e),new Promise(t=>{this.mover.move(r[0],{tolerance:100,callback:t})})}getText(){const t=this.doc.defaultView.getSelection();return t&&!t.isCollapsed?t.getRangeAt(0).toString():""}getSelection(t){return(t=t||this.doc.defaultView.getSelection())&&!t.isCollapsed?this.xDoc.fromSelection(t):null}newMark(){const t=this.getSelection().serializeToRange();return{id:o.IMark.uuid(),range:t}}getScrollMarkPosition(t){const e=this.doc.documentElement.clientTop||document.body.clientTop||0,n=window.pageYOffset||this.doc.documentElement.scrollTop,r=document.documentElement.clientHeight,o=Math.max(this.doc.body.scrollHeight,this.doc.body.offsetHeight,this.doc.documentElement.scrollHeight,this.doc.documentElement.offsetHeight,this.doc.documentElement.clientHeight);return{top:(t.getBoundingClientRect().top+n-e)/o*r,right:navigator.platform.toLowerCase().includes("mac")?16:0}}setMarksListener(t){this.listener=t}}},function(t,e,n){n.r(e),n.d(e,"ITextIndex",(function(){return r})),n.d(e,"ITextRange",(function(){return o})),n.d(e,"XSelection",(function(){return c})),n.d(e,"XDocument",(function(){return l})),n.d(e,"NodeUtils",(function(){return a}));var r,o,i=function(){function t(){}return t.indexOf=function(t,e,n){void 0===n&&(n=1);for(var r=0,o=-2;r<n&&-1!==o;)o=t.indexOf(e,o+1),r++;return o},t.indexOfNthNotEmptyChar=function(t,e){for(var n=0,r=-1;r<=e&&n<t.length;n++)if(!/\s+/m.test(t[n])&&++r===e)return n;return-1},t.indexOfNthNotEmptyCharFromEnd=function(t,e){for(var n=t.length-1,r=-1;r<=e&&n>-1;n--)if(!/\s+/m.test(t[n])&&++r===e)return n;return-1},t.find=function(e,n){var r=0,o=-2,i=[];if(n.length<1)return i;for(var a=t.compact(n);-1!==o&&!((o=e.indexOf(n,o+1))<0);)i.push({nth:++r,text:a,position:o});return i},t.compact=function(t){return t.replace(/\s+/gm,"")},t}(),a=function(){function t(){}return t.nextValidTextNode=function(t,e){for(t=e?t:this.nextNode(t);t;){var n=this.firstValidTextNode(t);if(n)return n;t=this.nextNode(t)}throw new Error("No Valid Text Node")},t.prevValidTextNode=function(t,e){for(t=e?t:this.prevNode(t);t;){var n=this.lastValidTextNode(t);if(n)return n;t=this.prevNode(t)}throw new Error("No Valid Text Node")},t.nextNode=function(t){for(var e=t.nextSibling;!e;)e=(t=t.parentNode).nextSibling;return e},t.prevNode=function(t){for(var e=t.previousSibling;!e;)e=(t=t.parentNode).previousSibling;return e},t.firstValidTextNode=function(t){if(this.isValidTextNode(t))return t;if(1===t.nodeType&&!this.isSkippable(t))for(var e=0,n=Array.from(t.childNodes);e<n.length;e++){var r=n[e],o=this.firstValidTextNode(r);if(o)return o}return null},t.lastValidTextNode=function(t){if(this.isValidTextNode(t))return t;if(1===t.nodeType&&!this.isSkippable(t))for(var e=0,n=Array.from(t.childNodes).reverse();e<n.length;e++){var r=n[e],o=this.lastValidTextNode(r);if(o)return o}return null},t.isValidTextNode=function(t){return 3===t.nodeType&&t.length>0&&/\S/.test(t.data)},t.getTextNodesBetween=function(t,e){var n=[],r=t;for(n.push(r);r!==e;)r=this.nextValidTextNode(r),n.push(r);return n},t.getValidTextNodes=function(t){var e=this;return this.isValidTextNode(t)?[t]:1!==t.nodeType||this.isSkippable(t)?[]:Array.from(t.childNodes).reduce((function(t,n){return t.concat(e.getValidTextNodes(n))}),[])},t.getContentTo=function(t,e,n){var r=this.firstValidTextNode(n.root),o=this.getTextNodesBetween(r,t),a=t.substringData(0,e),s=o.slice(0,o.length-1).map((function(t){return t.data.trim()})).join("")+a;return i.compact(s)},t.isSkippable=function(t){return this.elementsToSkip.test(t,null)},t.elementsToSkip={elements:["applet","area","base","basefont","bdo","button","frame","frameset","iframe","head","hr","img","input","link","map","meta","noframes","noscript","optgroup","option","param","script","select","style","textarea","title"],test:function(t,e){return(e||this.elements).indexOf(t.tagName.toLowerCase())>-1}},t}(),s=function(){function t(){}return t.trim=function(t){var e=t.startContainer,n=a.nextValidTextNode(e,!0),r=i.indexOfNthNotEmptyChar(n.data,0);if(e===n)if((r=Math.max(t.startOffset,r))>i.indexOfNthNotEmptyCharFromEnd(n.data,0))n=a.nextValidTextNode(n,!1),r=i.indexOfNthNotEmptyChar(n.data,0);else{var o=n.substringData(r,n.length-r);r+=i.indexOfNthNotEmptyChar(o,0)}var s=t.endContainer,c=a.prevValidTextNode(s,!0),l=i.indexOfNthNotEmptyCharFromEnd(c.data,0)+1;if(s===c)if((l=Math.min(t.endOffset,l))<=i.indexOfNthNotEmptyChar(c.data,0))c=a.prevValidTextNode(c,!1),l=i.indexOfNthNotEmptyCharFromEnd(c.data,0)+1;else{var u=c.substringData(0,l);l-=u.length-1-i.indexOfNthNotEmptyCharFromEnd(u,0)}return t.setStart(n,r),t.setEnd(c,l),t},t.extractTextNodes=function(t){var e=t.startContainer,n=t.endContainer,r=t.startOffset,o=t.endOffset;if(n.data.length!==o&&n.splitText(o),0!==r){var i=e.splitText(r);n===e&&(n=i,o-=r),e=i,r=0}return t.setStart(e,r),t.setEnd(n,o),a.getTextNodesBetween(e,n)},t}(),c=function(){function t(t,e){this.range=t,this.xdoc=e}return t.fromSelection=function(e,n){var r=t.rangeFromSelection(e,n);return t.fromRange(r,!1,n)},t.fromTextRange=function(e,n,r){void 0===n&&(n=!1),r.refresh();var o=t.rangeFromTextRange(e,r);return t.fromRange(o,n,r)},t.fromText=function(e,n,r){void 0===n&&(n=!1),r.refresh();var o=t.rangeFromText(e,r);return t.fromRange(o,n,r)},t.fromRange=function(e,n,r){if(void 0===n&&(n=!1),e){if(e=s.trim(e),n){var o=r.win.getSelection();o&&(o.removeAllRanges(),o.addRange(e))}return new t(e,r)}return null},t.rangeFromSelection=function(t,e){return t.rangeCount>0&&!t.isCollapsed?t.getRangeAt(0):null},t.rangeFromTextRange=function(e,n){var r=t.rangeFromText(e.start,n),o=t.rangeFromText(e.end,n);if(r&&o){var i=n.doc.createRange();return i.setStart(r.endContainer,r.endOffset),i.setEnd(o.endContainer,o.endOffset),i}return null},t.rangeFromText=function(t,e){var n=t.text,r=t.nth,o=e.nodes,a=i.compact(n),s=i.indexOf(e.text,a,r||1);if(s>-1){var c=s+o[0].startPosition,l=c+a.length,u=o.findIndex((function(t){return t.endPosition>=c})),f=o.findIndex((function(t){return t.startPosition>=l}))-1,d=o[u],h=f>=0?o[f]:o[o.length-1];if(d){var p=i.indexOfNthNotEmptyChar(d.data,c-d.startPosition),g=i.indexOfNthNotEmptyChar(h.data,l-h.startPosition-1),m=e.doc.createRange();return m.setStart(d,p),m.setEnd(h,g+1),m}}return null},t.prototype.trim=function(){var t=this.xdoc.win.getSelection();t&&(t.removeAllRanges(),t.addRange(s.trim(this.range)))},t.prototype.getTextNodes=function(){if(this.texts)return this.texts;this.texts=s.extractTextNodes(this.range);var t=this.xdoc.win.getSelection();return t&&t.rangeCount>0&&(t.collapseToStart(),t.empty&&t.empty(),t.removeAllRanges&&t.removeAllRanges()),this.texts},t.prototype.serializeToIndex=function(){var t=i.compact(this.range.toString());if(t.length<1)return r.None;var e=a.getContentTo(this.range.endContainer,this.range.endOffset,this.xdoc),n=i.find(e,t);return n&&n.length>0?n[n.length-1]:r.None},t.prototype.serializeToRange=function(t){if(void 0===t&&(t=5),i.compact(this.range.toString()).length<1)return o.None;var e=a.getContentTo(this.range.endContainer,this.range.endOffset,this.xdoc),n=e.length>t?e.substr(e.length-t,t):e,r=i.find(e,n),s=a.getContentTo(this.range.startContainer,this.range.startOffset,this.xdoc),c=s.length>t?s.substr(s.length-t,t):s,l=i.find(s,c);return l&&l.length>0&&r&&r.length>0?{start:l[l.length-1],end:r[r.length-1]}:o.None},t.prototype.getContent=function(t){return void 0===t&&(t=!1),t?i.compact(this.range.toString()):this.range.toString()},t.prototype.toSelection=function(){var t=this.xdoc.win.getSelection();return t.rangeCount<1&&t.addRange(this.range),t},t.prototype.empty=function(){if(this.texts&&!(this.texts.length<1)){var t=this.range.startContainer,e=this.range.endContainer;t&&t.parentNode&&t.parentNode.normalize(),e&&e.parentNode&&e.parentNode.normalize(),this.range.collapse(),this.texts=[];var n=this.xdoc.win.getSelection();n.collapseToStart(),n.empty&&n.empty(),n.removeAllRanges&&n.removeAllRanges()}},t.prototype.isEmpty=function(){var t=this.xdoc.win.getSelection();return!t||t.rangeCount<1||t.isCollapsed||this.range.collapsed},t}(),l=function(){function t(t){this.selection=null,this.root=t,this.doc=t instanceof Document?t:t.ownerDocument,this.win=this.doc.defaultView,this.refresh()}return t.from=function(e){return void 0===e&&(e=document.body),new t(e)},t.prototype.refresh=function(){var t=a.getValidTextNodes(this.root),e=0,n="";t.forEach((function(t){t.startPosition=e;var r=i.compact(t.data);n+=r,e+=r.length,t.endPosition=e-1})),this.text=n,this.nodes=t},t.prototype.select=function(t,e,n){if(void 0===e&&(e=1),void 0===n&&(n=!1),t&&t.trim())this.selection&&!this.selection.isEmpty()&&this.selection.empty(),this.selection=this.fromText(t.trim(),e,n);else{var r=this.win.getSelection();r&&(this.selection=this.fromSelection(r))}return this.selection},t.prototype.fromSelection=function(t){return this.selection=c.fromSelection(t,this)},t.prototype.fromText=function(t,e,n){return void 0===e&&(e=1),void 0===n&&(n=!1),this.selection=this.fromTextIndex({text:t,nth:e},n)},t.prototype.fromTextIndex=function(t,e){return void 0===e&&(e=!1),this.selection=c.fromText(t,e,this)},t.prototype.fromTextRange=function(t,e){return void 0===e&&(e=!1),this.selection=c.fromTextRange(t,e,this)},t.prototype.normalize=function(){var t=this;this.root.normalize();var e=0;this.nodes.reverse().forEach((function(n,r){n.parentNode?e>0&&(n.endPosition=e):(e=n.endPosition,t.nodes.splice(t.nodes.length-r,1))}))},t}();!function(t){t.None={nth:-1,position:-1,text:""}}(r||(r={})),function(t){t.None={start:{text:"",nth:-1},end:{text:"",nth:-1}},t.toSimpleString=function(t){return JSON.stringify([t.start.nth+":"+t.start.text,t.end.nth+":"+t.end.text])},t.fromSimpleString=function(t){var e=JSON.parse(t),n=e[0].split(":",2),r=e[1].split(":");return{start:{text:n[1],nth:parseInt(n[0],10)},end:{text:r[1],nth:parseInt(r[0],10)}}}}(o||(o={}))},function(t,e,n){var r=function(){var t={tolerance:0,duration:800,easing:"easeOutQuart",container:window,callback:function(){}};function e(t,e,n,r){return t/=r,-n*(--t*t*t*t-1)+e}function n(t,e){var n={};return Object.keys(t).forEach((function(e){n[e]=t[e]})),Object.keys(e).forEach((function(t){n[t]=e[t]})),n}function r(t){return t instanceof HTMLElement?t.scrollTop:t.pageYOffset}function o(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options=n(t,r),this.easeFunctions=n({easeOutQuart:e},o)}return o.prototype.registerTrigger=function(t,e){var r=this;if(t){var o=t.getAttribute("href")||t.getAttribute("data-target"),i=o&&"#"!==o?document.getElementById(o.substring(1)):document.body,a=n(this.options,function(t,e){var n={};return Object.keys(e).forEach((function(e){var r=t.getAttribute("data-mt-".concat(e.replace(/([A-Z])/g,(function(t){return"-"+t.toLowerCase()}))));r&&(n[e]=isNaN(r)?r:parseInt(r,10))})),n}(t,this.options));"function"==typeof e&&(a.callback=e);var s=function(t){t.preventDefault(),r.move(i,a)};return t.addEventListener("click",s,!1),function(){return t.removeEventListener("click",s,!1)}}},o.prototype.move=function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===t||t){o=n(this.options,o);var i,a="number"==typeof t?t:t.getBoundingClientRect().top,s=r(o.container),c=null;a-=o.tolerance;var l=function n(l){var u=r(e.options.container);c||(c=l-1);var f=l-c;if(i&&(a>0&&i>u||a<0&&i<u))return o.callback(t);i=u;var d=e.easeFunctions[o.easing](f,s,a,o.duration);o.container.scroll(0,d),f<o.duration?window.requestAnimationFrame(n):(o.container.scroll(0,a+s),o.callback(t))};window.requestAnimationFrame(l)}},o.prototype.addEaseFunction=function(t,e){this.easeFunctions[t]=e},o}();t.exports=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(3),i=r.__importStar(n(13));class a{static decode(t){const e=i.decompressFromEncodedURIComponent(t);return JSON.parse(e).map(t=>o.IMark.deflat(t))}static encode(t){const e=t.map(t=>o.IMark.flat(t)),n=JSON.stringify(e);return i.compressToEncodedURIComponent(n)}static decodeMarks(t){try{if(t)return a.decode(decodeURIComponent(t))}catch(t){}return[]}static encodeMarks(t,e){if(e){const n=t.findIndex(t=>t.id===e),r=t[t.length-1];t[t.length-1]=t[n],t[n]=r}return t.length>0?encodeURIComponent(a.encode(t)):""}}e.default=a},function(t,e,n){var r,o=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(t,e){if(!r[t]){r[t]={};for(var n=0;n<t.length;n++)r[t][t.charAt(n)]=n}return r[t][e]}var i={compressToBase64:function(t){if(null==t)return"";var n=i._compress(t,6,(function(t){return e.charAt(t)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:i._decompress(t.length,32,(function(n){return o(e,t.charAt(n))}))},compressToUTF16:function(e){return null==e?"":i._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:i._decompress(t.length,16384,(function(e){return t.charCodeAt(e)-32}))},compressToUint8Array:function(t){for(var e=i.compress(t),n=new Uint8Array(2*e.length),r=0,o=e.length;r<o;r++){var a=e.charCodeAt(r);n[2*r]=a>>>8,n[2*r+1]=a%256}return n},decompressFromUint8Array:function(e){if(null==e)return i.decompress(e);for(var n=new Array(e.length/2),r=0,o=n.length;r<o;r++)n[r]=256*e[2*r]+e[2*r+1];var a=[];return n.forEach((function(e){a.push(t(e))})),i.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":i._compress(t,6,(function(t){return n.charAt(t)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),i._decompress(t.length,32,(function(e){return o(n,t.charAt(e))})))},compress:function(e){return i._compress(e,16,(function(e){return t(e)}))},_compress:function(t,e,n){if(null==t)return"";var r,o,i,a={},s={},c="",l="",u="",f=2,d=3,h=2,p=[],g=0,m=0;for(i=0;i<t.length;i+=1)if(c=t.charAt(i),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=d++,s[c]=!0),l=u+c,Object.prototype.hasOwnProperty.call(a,l))u=l;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;r<h;r++)g<<=1,m==e-1?(m=0,p.push(n(g)),g=0):m++;for(o=u.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1}else{for(o=1,r=0;r<h;r++)g=g<<1|o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o=0;for(o=u.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1}0==--f&&(f=Math.pow(2,h),h++),delete s[u]}else for(o=a[u],r=0;r<h;r++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1;0==--f&&(f=Math.pow(2,h),h++),a[l]=d++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;r<h;r++)g<<=1,m==e-1?(m=0,p.push(n(g)),g=0):m++;for(o=u.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1}else{for(o=1,r=0;r<h;r++)g=g<<1|o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o=0;for(o=u.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1}0==--f&&(f=Math.pow(2,h),h++),delete s[u]}else for(o=a[u],r=0;r<h;r++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1;0==--f&&(f=Math.pow(2,h),h++)}for(o=2,r=0;r<h;r++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1;for(;;){if(g<<=1,m==e-1){p.push(n(g));break}m++}return p.join("")},decompress:function(t){return null==t?"":""==t?null:i._decompress(t.length,32768,(function(e){return t.charCodeAt(e)}))},_decompress:function(e,n,r){var o,i,a,s,c,l,u,f=[],d=4,h=4,p=3,g="",m=[],y={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)f[o]=o;for(a=0,c=Math.pow(2,2),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*l,l<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 2:return""}for(f[3]=u,i=u,m.push(u);;){if(y.index>e)return"";for(a=0,c=Math.pow(2,p),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*l,l<<=1;switch(u=a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*l,l<<=1;f[h++]=t(a),u=h-1,d--;break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*l,l<<=1;f[h++]=t(a),u=h-1,d--;break;case 2:return m.join("")}if(0==d&&(d=Math.pow(2,p),p++),f[u])g=f[u];else{if(u!==h)return null;g=i+i.charAt(0)}m.push(g),f[h++]=i+g.charAt(0),i=g,0==--d&&(d=Math.pow(2,p),p++)}}};return i}();void 0===(r=function(){return o}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});const r=n(0).__importDefault(n(1)),o=n(15);e.default=class{constructor(t){this.target=t,this.$host=document.createElement("anylink-viewer-banners"),this.$host.style.position="fixed",this.$host.style.bottom="16px",this.$host.style.right="16px",this.$host.style.zIndex="2147483647",this.$root=this.$host.attachShadow({mode:"open"}),this.$el=r.default.toElement(this.getTemplate(t).trim());const e=this.$el.querySelectorAll(".banner-action-close");for(let t of e)t.addEventListener("click",t=>{t.target.closest(".banner").style.display="none"});const n=r.default.toElement(o.style);this.$root.appendChild(n),this.$root.appendChild(this.$el)}getTemplate(t){return`\n      <div class="banners">\n        <div class="banner warning" style="margin-bottom: 8px">\n          <header class="banner-head">\n            <div class="banner-head-icon warning"></div>\n          </header>\n          <main class="banner-body">\n            <div class="banner-body-title">\n              Please do NOT input any information in this page!<br>\n              请不要在此页面输入任何内容！\n            </div>\n            <div class="banner-body-subtitle">\n              this page is proxied by <a href="javascript:void(0)">${document.location.origin}</a> and only for view!<br>\n              本页面由代理服务器(<a href="javascript:void(0)">${document.location.origin}</a>)提供，仅供浏览！\n            </div>\n            <div class="banner-body-actions">\n              <a class="banner-body-action-open" href="${t.href}" target="_blank">\n                <img src="${t.origin}/favicon.ico" alt="${t.origin}">\n                Open origin page\n              </a>\n            </div>\n          </main>\n          <footer class="banner-actions">\n            <div class="banner-action-close">×</div>\n          </footer>\n        </div>\n        <div class="banner anylink">\n          <header class="banner-head">\n            <div class="banner-head-icon anylink"></div>\n          </header>\n          <main class="banner-body">\n            <div class="banner-body-title">Highlights are powered by ©Anylink</div>\n            <div class="banner-body-subtitle">Anylink is a chrome extension allowing you to <span\n              style="font-weight: 300; background-color: #ffe168">create link/highlight on any text\n            in any web page and share anywhere</span>. Safe and reliable! All are done absolute locally!\n            </div>\n            <div class="banner-body-actions">\n              <a class="banner-body-action-open" href="https://chrome.google.com/webstore/detail/mpflpgaobfpjcpefkdnpalfdodifkkgc" target="_blank">\n                <img src="http://www.anyl.ink/favicon.ico" alt="www.anyl.ink">Install ©Anylink from Chrome Web Store\n              </a>\n            </div>\n          </main>\n          <footer class="banner-actions">\n            <div class="banner-action-close">×</div>\n          </footer>\n        </div>\n      </div>\n    `}}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.style='\n<style type="text/css">\na:link,\na:visited,\na:hover,\na:active {\n  color: unset;\n  text-decoration: none;\n}\n.banner {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  border: 1px solid grey;\n  border-radius: 4px;\n  width: 440px;\n  height: 88px;\n  padding: 16px;\n  position: relative;\n  background-color: white;\n  font-family: Roboto, sans-serif;\n}\n.banner-head {\n  margin-right: 8px;\n}\n.banner-head-icon {\n  height: 56px;\n  width: 56px;\n  background-position: center;\n  background-size: contain;\n  background-repeat: no-repeat;\n}\n.banner-head-icon.anylink {\n  background-image: url(http://www.anyl.ink/logo.png);\n}\n.banner-head-icon.warning {\n  background-image: url(data:image/svg+xml;base64,PHN2ZyB0PSIxNTc4MjI0MTY5MTE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwMjAiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNNTUyLjA2OTU2NSAyOC45MzkxM2w0NjMuMDI2MDg3IDkyMy44MjYwODdjMTEuMTMwNDM1IDIyLjI2MDg3IDIuMjI2MDg3IDQ4Ljk3MzkxMy0yMC4wMzQ3ODIgNjAuMTA0MzQ4LTYuNjc4MjYxIDIuMjI2MDg3LTEzLjM1NjUyMiA0LjQ1MjE3NC0yMC4wMzQ3ODMgNC40NTIxNzRINTEuMmMtMjQuNDg2OTU3IDAtNDQuNTIxNzM5LTIwLjAzNDc4My00NC41MjE3MzktNDQuNTIxNzM5IDAtNi42NzgyNjEgMi4yMjYwODctMTMuMzU2NTIyIDQuNDUyMTc0LTIwLjAzNDc4M0w0NzQuMTU2NTIyIDI4LjkzOTEzQzQ4NS4yODY5NTcgNi42NzgyNjEgNTEyLTIuMjI2MDg3IDUzNC4yNjA4NyA4LjkwNDM0OGM2LjY3ODI2MSA0LjQ1MjE3NCAxMy4zNTY1MjIgMTMuMzU2NTIyIDE3LjgwODY5NSAyMC4wMzQ3ODJ6TTQ2Ny40NzgyNjEgMzUxLjcyMTczOXYzNTYuMTczOTEzaDg5LjA0MzQ3OHYtMzU2LjE3MzkxM2gtODkuMDQzNDc4eiBtNDQuNTIxNzM5IDUzNC4yNjA4N2MzNy44NDM0NzggMCA2Ni43ODI2MDktMjguOTM5MTMgNjYuNzgyNjA5LTY2Ljc4MjYwOXMtMjguOTM5MTMtNjYuNzgyNjA5LTY2Ljc4MjYwOS02Ni43ODI2MDktNjYuNzgyNjA5IDI4LjkzOTEzLTY2Ljc4MjYwOSA2Ni43ODI2MDljMCAzNS42MTczOTEgMjguOTM5MTMgNjYuNzgyNjA5IDY2Ljc4MjYwOSA2Ni43ODI2MDl6IiBmaWxsPSIjRkZDRDAwIiBwLWlkPSIyMDIxIj48L3BhdGg+PC9zdmc+Cg==);\n}\n.banner-body {\n  flex-grow: 1;\n  font-size: 12px;\n  height: 100%;\n}\n.banner-body-title {\n  font-weight: bold;\n}\n.banner-body-subtitle {\n  font-weight: lighter;\n  font-size: 11px;\n}\n.banner-body-actions {\n  color: rgba(0, 0, 0, 0.56);\n  font-size: 0.75rem;\n  position: absolute;\n  right: 24px;\n  bottom: 10px;\n  display: flex;\n  flex-direction: row;\n}\n.banner-body-action-open {\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n}\n.banner-body-action-open img {\n  height: 12px;\n  width: 12px;\n  margin-right: 8px;\n}\n.banner-action-close {\n  color: rgba(0, 0, 0, 0.56);\n  font-size: 18px;\n  position: absolute;\n  right: 0;\n  top: 0;\n  cursor: pointer;\n  border-radius: 50%;\n  height: 24px;\n  width: 24px;\n  display: flex;\n  text-align: center;\n  justify-content: center;\n  align-items: center;\n}\n.banner-action-close:hover {\n  color: red;\n}\n</style>\n'}]);